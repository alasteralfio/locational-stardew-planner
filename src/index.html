<!DOCTYPE html>
<html>
    <head>
        <title>Stardew Valley Planner</title>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/fabric.js/5.3.0/fabric.min.js"></script>
        <link rel="stylesheet" href="./styles.css" />
    </head>
    <body>
        <div id="top-controls">
            <button onclick="window.appState.saveCurrentLayout()">
                Save Layout
            </button>
            <input
                type="file"
                id="loadFileInput"
                accept=".json"
                style="display: none"
                onchange="window.appState.loadLayout(this.files[0]).catch(console.error)"
            />
            <button onclick="document.getElementById('loadFileInput').click()">
                Load Layout
            </button>
            <button onclick="window.appState.createNewLayout()">
                New Layout
            </button>
            <button onclick="console.log('Current appState:', window.appState)">
                Debug State
            </button>
        </div>
        <!-- Object Palette UI -->
        <div id="palette-container">
            <!-- Category Toolbar -->
            <div id="category-toolbar">
                <button
                    class="category-btn"
                    data-category="buildings"
                    title="Buildings"
                >
                    <div style="background: #666">B</div>
                </button>
                <button
                    class="category-btn"
                    data-category="crops"
                    title="Crops"
                >
                    <div style="background: #4a752c">C</div>
                </button>
                <button
                    class="category-btn"
                    data-category="decor"
                    title="Decor"
                >
                    <div style="background: #8b4513">D</div>
                </button>
                <button
                    class="category-btn"
                    data-category="machines"
                    title="Machines"
                >
                    <div style="background: #708090">M</div>
                </button>
                <button
                    class="category-btn"
                    data-category="wallpaper"
                    title="Wallpaper"
                >
                    <div style="background: #9370db">W</div>
                </button>
            </div>

            <!-- Expanding Palette Panel (hidden by default) -->
            <div id="palette-panel">
                <div id="search-container">
                    <input
                        type="text"
                        id="search-input"
                        placeholder="Search objects..."
                    />
                    <button id="close-palette-btn">âœ•</button>
                </div>
                <div id="objects-grid"></div>
            </div>
        </div>

        <!-- Status Bar -->
        <div id="status-bar">
            <span id="cursor-coords">X: 0, Y: 0</span>
            <span id="selected-object" style="margin-left: 20px"
                >Selected: None</span
            >
        </div>
        <canvas id="layer-0"></canvas>
        <canvas id="layer-1"></canvas>
        <canvas id="layer-2"></canvas>
        <canvas id="layer-3"></canvas>
        <canvas id="layer-4"></canvas>
        <canvas id="layer-5"></canvas>

        <!-- Load in dependency order -->
        <script type="module">
            import { appState } from "./core/appState.js";
            import { init } from "./core/renderEngine.js";

            // Make appState globally available
            window.appState = appState;

            // Initialize when page loads
            document.addEventListener("DOMContentLoaded", async () => {
                await init();
            });
        </script>
    </body>
</html>
