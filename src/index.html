<!DOCTYPE html>
<html>
<head>
    <title>Stardew Valley Planner</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fabric.js/5.3.0/fabric.min.js"></script>
<style>
    /* Base canvas positioning */
    canvas { 
        position: absolute; 
        top: 0; 
        left: 0; 
    }
    
    /* SPECIFIC Z-INDEX STACKING ORDER */
    #layer-0 { z-index: 1; } /* Terrain - bottom */
    #layer-1 { z-index: 2; } /* Walls/Floors */
    #layer-2 { 
        z-index: 3; 
        cursor: grab; /* Make it clear this layer is interactive */
    } /* Paths - INTERACTIVE LAYER */
    
    /* Fabric.js canvases - must be UNDER layer-2 for events */
    #layer-3, 
    #layer-3 .lower-canvas,
    #layer-3 .upper-canvas {
        z-index: 1; /* BELOW layer-2 */
        pointer-events: none; /* Ensure no event interception */
    }
    
    #layer-4 { 
        z-index: 4; 
        pointer-events: none; /* Grid overlay - visible but non-interactive */
    } /* Overlay - top */
</style>
</head>
<body>
    <div style="position: absolute; top: 10px; left: 10px; z-index: 100; background: rgba(0,0,0,0.7); color: white; padding: 10px; border-radius: 5px;">
        <button onclick="window.appState.saveCurrentLayout()">Save Layout</button>
        <input type="file" id="loadFileInput" accept=".json" style="display: none;" onchange="window.appState.loadLayout(this.files[0]).catch(console.error)">
        <button onclick="document.getElementById('loadFileInput').click()">Load Layout</button>
        <button onclick="window.appState.createNewLayout()">New Layout</button>
        <button onclick="console.log('Current appState:', window.appState)">Debug State</button>
    </div>
    <canvas id="layer-0"></canvas>
    <canvas id="layer-1"></canvas>
    <canvas id="layer-2"></canvas>
    <canvas id="layer-3"></canvas>
    <canvas id="layer-4"></canvas>

    <!-- Load in dependency order -->
    <script src="core/appState.js"></script>
    <script src="core/constants.js" type="module"></script>
    <script src="core/locationManager.js" type="module"></script>
    <script src="core/assetLoader.js" type="module"></script>
    <script src="core/renderHelpers.js" type="module"></script>
    <script src="core/interactionHandler.js" type="module"></script>
    <script src="core/renderEngine.js" type="module"></script>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            if (window.renderEngine && window.renderEngine.init) {
                window.renderEngine.init();
            } else {
                console.error('Render engine not found');
            }
        });
    </script>
</body>
</html>